<?xml version="1.0"?>
<!-- This line is a comment that won't appear in the generated document. -->
<!DOCTYPE rfc SYSTEM "rfc2629.dtd"[
      <!-- For each RFC you want to reference, add a line like below and then
           see the references section at the end.  This line tells the
           tool to pull the reference from the database. -->
      <!ENTITY rfc2119 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.2119.xml">
      <!ENTITY rfc3315 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3315.xml">
      <!ENTITY rfc3972 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.3972.xml">
      <!ENTITY rfc4941 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4941.xml">
      <!ENTITY rfc4944 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.4944.xml">
      <!ENTITY rfc5535 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.5535.xml">
      <!ENTITY rfc6282 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6282.xml">
      <!ENTITY rfc6496 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6496.xml">
      <!ENTITY rfc6724 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6724.xml">
      <!ENTITY rfc6775 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6775.xml">
      <!ENTITY rfc6973 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.6973.xml">
      <!ENTITY rfc7136 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7136.xml">
      <!ENTITY rfc7217 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7217.xml">
      <!ENTITY rfc7421 SYSTEM "http://xml.resource.org/public/rfc/bibxml/reference.RFC.7421.xml">
      <!-- For each Internet Draft you want to reference, add a line like
           below and then see the references section at the end. -->
      <!ENTITY I-D.ietf-6man-ipv6-address-generation-privacy PUBLIC ''
          'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-6man-ipv6-address-generation-privacy.xml'>
      <!ENTITY I-D.ietf-6man-default-iids PUBLIC ''
          'http://xml.resource.org/public/rfc/bibxml3/reference.I-D.ietf-6man-default-iids.xml'>
      ]>
<?rfc toc='yes' ?>
<?rfc symrefs='yes' ?>
<?rfc sortrefs='no'?>
<?rfc compact='yes'?>
<!-- <?rfc-ext parse-xml-in-artwork='yes' ?> -->
<!-- <?xml-stylesheet type='text/xsl' href='rfc2629.xslt' ?> -->

<rfc docName="draft-thaler-6lo-privacy-addrs-00" ipr="trust200902" category="std">
  <front>
    <title abbrev='6LoWPAN Privacy Addresses'>Enabling Privacy Addressing With 6LoWPAN Technologies</title>
    <author initials='D.' surname='Thaler' fullname='Dave Thaler'>
      <organization>Microsoft</organization>
      <address>
        <postal>
          <street>One Microsoft Way</street>
          <city>Redmond</city>
          <region>WA</region>
          <code>98052</code>
          <country>USA</country>
        </postal>
        <email>dthaler@microsoft.com</email>
      </address>
    </author>
    <date year='2015' />
    <area>Internet</area>
    <keyword>unlinkability</keyword>
    <keyword>anonymity</keyword>
    <keyword>IPv6</keyword>
    <keyword>Secure Neighbor Discovery</keyword>
    <abstract>
      <t> It is commonly assumed today that 6LowPAN header compression is incompatible (or at least
          inefficient) with the notion of using addresses with sufficient entropy to mitigate various
          privacy threats.  This draft explores ways to dispel that notion, and discusses how 
          privacy addressing could be used on 6LoWPAN technologies without additional overhead in data packets.
      </t>
    </abstract>
  </front>
 
  <middle>
    <section title='Introduction'>
      <t> RFC 6973 <xref target='RFC6973'/> discusses privacy considerations for Internet protocols, and Section 5.2
          in particular covers a number of privacy-specific threats.  In the context of IPv6 address,
          Section 3 of <xref target='I-D.ietf-6man-ipv6-address-generation-privacy'/> provides further
          elaboration on the applicability of the privacy threats.  When interface identifiers (IIDs) are
          generated without sufficient entropy, devices and users become vulnerable to
          the various threats discussed there, including correlation of activities over time, location tracking,
          address scanning, and device-specific vulnerability exploitation.
      </t>
      <t> Interfaces identifiers formed from IEEE identifiers can have insufficient entropy unless the
          IEEE identifier itself has sufficient entropy, and enough bits of entropy
          are carried over into the IPv6 address to sufficiently mitigate the threats.
          (Typically "enough" bits of entropy means on the order of 60 or more bits; ideally all 64 bits of
          the IID would be used, but historically a couple bits have been excluded for reasons discussed 
          in <xref target='RFC7421'/>.)
          Furthermore, IEEE-identifier-based IIDs are also insufficient to
          prevent location tracking unless the IEEE identifier itself is different at each network location.
          This observation suggests that the privacy threats can be mitigated in either of two ways:
          either use an IPv6 address generation mechanism that is not IEEE-identifier-based, or else
          make sure the IEEE identifier contains around 60 bits of entropy and is changed if a device moves
          to a different network.  For this reason, <xref target='I-D.ietf-6man-default-iids'/> recommends
          using the address generation scheme in <xref target='RFC7217'/> by default, rather than 
          IEEE-identifier-based addresses.
      </t>
      <t> Furthermore, to mitigate the threat of correlation of activities over time, <xref target='RFC4941'/>
          specifies the notion of a "temporary" address to be used for sessions that should not be linkable
          to more permanent identifiers (such as a DNS name, user name, or stable hardware address).  Such
          temporary addresses
          are appropriate for connections (typically locally-initiated outbound sessions) that an attacker
          cannot link to a stable identifier such as a user name or DNS name.  Indeed, the default
          address selection rules <xref target='RFC6724'/> now prefer temporary addresses by default for
          outgoing connections.  When temporary addresses are used, a new temporary address is periodically
          (default is 1 day in xref target='RFC4941'/>)
          generated, which limits the threat of correlation of activies over time to that period.  The address itself
          though may still be usable for existing long-lived connections (but not new connections) for
          some longer period (default is 1 week); this allows for not breaking application sessions, especially
          those that might be initiated shortly before a new temporary address is generated.  This fact means
          that multiple temporary addresses can exist at the same time, one for new connections, and one or more
          (often up to 6, per the default periods) old ones for long-lived connections.  This is in addition to
          zero or more "stable" addresses that might be used for connections that are linkable to more permanent
          identifiers such as DNS names or user names.  Whereas most threats could be mitigated if the
          IEEE identifier contains sufficient entropy and is different per-network, mitigating the threat of
          correlation of activities over time typically cannot be done using an IEEE identifier, since mitigating
          such a threat typically involves the ability to use multiple IPv6 addresses simultaneously whereas
          typically only one IEEE identifier can be used at a time.
      </t>
      <t> Finally, allowing efficient use of addresses that are not IEEE-identifier-based also has additional
          security benefits not specific to privacy.  For example, addresses such as
          Cryptographically Generated Addresses (CGAs) <xref target='RFC3972'/> and
          Hash-Based Addresses (HBAs) <xref target='RFC5535'/> can be used in security protocols
          such as Secure Neighbor Discovery (SeND) <xref target='RFC6496'/>, IPsec, etc.  Such techniques
          rely on having around 60 or more bits of entropy in the address to provide sufficient
          cryptographic protection.
      </t>
      <t> RFC 6775 <xref target='RFC6775'/> already allows for the use of non-IEEE-identifier-based
          addresses, such as those provided by DHCPv6 <xref target='RFC3315'/>.
          There has been some concern, however, that such approaches necessarily interfere with efficient header
          compression for IPv6 over IEEE 802.15.4-based networks <xref target='RFC6282'/>, as it is important
          to keep data packets small on such networks.  This document discusses how one might use such addresses
          on these networks while avoiding extra overhead.
      </t>
    </section>

    <section title='Terminology'>
      <t> This document uses the terminology defined in Section 3 of <xref target='RFC6973'/>, including
          terms such as "(un)linkability" and "anonymity set".
      </t>
      <t>  The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
           "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this
           document are to be interpreted as described in <xref target='RFC2119'/>.
      </t>
    </section>

    <section title='Compression Details'>
      <t> The LOWPAN_IPHC encoding format specified in Section 3.1 of RFC 6282 <xref target='RFC6282'/>
          defines a method for deriving IIDs from the source and/or destination addresses in the
          encapsulation header.  Unicast IPv6 addresses may be compressed
          to 64, 16, or 0 bits in the encoded IPv6 header. 
      </t>

      <section title='Use of IEEE-Identifier-Based Addresses'>
        <t> As noted earlier, some privacy threats, could be mitigated using per-network "randomized"
            IEEE identifiers with 60 or more bits of entropy.  A number of such proposals can be found at
            &lt;https://mentor.ieee.org/privecsg/documents&gt;.  Using IPv6 addresses derived from
            such IEEE identifiers would be roughly equivalent to those specified in <xref target='RFC7217'/>.
        </t>
        <t> Such addresses would be encoded as usual using the LOWPAN_IPHC encoding format.  For example,
            if the source and destination addresses are both on-link and derived from the IEEE identifier
            in the encapsulating header:
        </t>
        <t><list style='symbols'>
            <t> SAC (Source Address Compression) is set to 0 to indicate stateless compression.
            </t>
            <t> SAM (Source Address Mode) is set to 11 to indicate the address is fully elided and can
                be computed from the encapsulating header.
            </t>
            <t> DAC (Destination Address Compression) is set to 0 to indicate stateless compression.
            </t>
            <t> DAM (Destination Address Mode) is set to 11 to indicate the address is fully elided and can
                be computed from the encapsulating header.
            </t>
          </list>
        </t>
      </section>

      <section title='Use of 16-Bit Short Addresses'>
        <t> An IPv6 address formed (per Secton 6 of <xref target='RFC4944'/>) from an IEEE 802.15.4 16-bit
            short address does not provide sufficient
            entropy to fully mitigate address scanning, as the size of the address scan search space depends
            on the entropy in the IID, and only 15 bits are available for unicast addresses.  An adversary could
            also use statisical methods to determine the size of the L2 address space and thereby make some
            inference regarding the underlying technology being IEEE 802.15.4 on a given link.  As such,
            this address generation mechanism SHOULD NOT be used on networks connected to the Internet or any
            other network where privacy threats may be an issue.
        </t>
        <t> It might be possible to construct IPv6 addresses from 16-bit short addresses using an alternate
            mechanism that mitigates address scans, by all nodes on a given L2 network having a shared secret
            (such as the key needed to get on the layer-2 network), and generating the IID by using a 
            one-way hash of the shared secret together with the short address. The use of such a hash causes 
            the IIDs to be spread out among the full range of IIDs.
        </t>
        <t> "Temporary" addresses could possibly also be generated in the same way by including in the hash
            the Version Number from the Authoritative Border Router Option (ABDO) if any.  This would
            allow changing temporary addresses whenever the Version Number is changed (even if the set of
            prefix or context information is unchanged). Such a scheme would likely require using
            the Context Identifier (CID) to distinguish between non-temporary addresses, "current"
            temporary addresses, and "past" temporary addresses based on a previous Version Number.
        </t>
        <t> Specifying further details of such a scheme is left for future versions of this draft,
            if there is interest.
        </t>
      </section>

      <section title='Use of Non-IEEE-Identifier-Based Addresses'>
        <t> Unicast addresses that are not IEEE-identifier
            based SHOULD be compressed to 0 bits as follows, using stateful context-based compression where
            all IID bits are covered by context information.  It is also worth pointing out that, unlike
            stateless compression, stateful context-based compression can also allow compressing addresses
            of nodes outside the local network (i.e., where the IEEE identifier in the encapsulating
            header is that of a router rather than the peer) and hence can provide greater savings in
            such cases.  Furthermore, this scheme would allow compressing DHCPv6-assigned addresses even
            in networks where privacy is not a primary concern.
        </t>

        <section title='Source Address'>
          <t> SAC (Source Address Compression) MUST be set to 1 to indicate stateful
              context-based compression.
          </t>
          <t> SAM (Source Address Mode) MUST be set to 11 to indicate that the address is fully elided.
          </t>
        </section>

        <section title='Destination Address'>
          <t> DAC (Destination Address Compression) MUST be set to 1 to indicate stateful
              context-based compression.
          </t>
          <t> DAM (Destination Address Mode) MUST be set to 11 to indicate that the address is fully elided.
          </t>
        </section>

        <section title='Context Identifier' anchor='cid'>
          <t> When non-IEEE-identifier-based addresses are used as specified in
              this document, each address MUST be associated with a separate context.
          </t>
          <t> LOWPAN_IPHC supports up to 16 source address contexts and 16 destination address contexts,
              allowing for simultaneous use of up to 16 source addresses and 16 destination addresses
              that are not IEEE-identifier based.  Context 0 is the default context if the CID
              (Context Identifier Extension) octet is absent, and other values require the CID to be present.
              As such, the address most commonly used (typically either the
              stable non-temporary address, or the currently preferred temporary address) could be assigned
              to context 0 so that the presence of the CID octet is minimized.
          </t>
          <!--
              If this results in the desire to change the assignment over time, this would necessitate
              the use of a dynamic context negotiation mechanism. 
              For example, if the set of destinations can vary dynamically over time, such as if the
              device responds to arbitrary other nodes querying it, the destination-context-to-address mapping
              may change when a new peer wants to communicate with the device.
              Similarly, if temporary addresses are used as source or destination addresses, then some
              context-to-address mapping may change once a day. 

              If temporary addresses are not used, and the set of peers with which a device communicates
              on a given network is fixed and 16 or fewer in number, then a static context-to-address mapping
              for that network is sufficient.

              If the device is capable of roaming between multiple networks, then any context information
              MUST be per-network, and not used on other networks.
          -->
        </section>

        <section title='Context State'>
          <t> As specified in <xref target='RFC6775'/>, context state is distributed by routers and is
              shared across a LoWPAN.  This means that the use of CIDs described above would only
              support compression of 16 addresses across the entire LoWPAN.  However, Section 8 of
              <xref target='RFC6775'/> explicitly allows for context dissemination to be substituted by
              alternatives defined in other specifications.  We now describe such a substitute that
              would allow header compression with up to 16 source addresses and 16 destination addresses
              *per node*.
          </t>
          <t> First, a context entry is defined to be indexed by a { link-layer address, CID } tuple,
              rather than just a CID.  Second, each node is responsible for generating and disseminating
              the CIDs for its own IPv6 addresses.
          </t>
          <t> Thus, each Neighbor Cache Entry (NCE) conceptually contains the CID of the neighbor's address,
              used when compressing packets sent to it.
          </t>
        </section>

        <section title='Context Distribution'>
          <t> To disseminate CID information from a host to a router, the Address Registration Option (ARO)
              defined in Section 4.1 of <xref target='RFC6775'/> can be extended to include the CID by
              using 5 of the 24 Reserved bits (one for a flag to denote a CID is present, and 4 for the CID).
              Similarly, the Duplicate Address Request (DAR) and Duplicate Address Confirmation (DAC) messages
              can similarly be extended to include the CID in currently Reserved bits.
          </t>
          <!--
              Section 4.2 of <xref target='RFC6775'/> defines the 6LoWPAN Context Option (6CO) for use in
              Neighbor Discovery.  Since each non-IEEE-identifier-based address requires its own context,
              the Context Length field MUST be set to 128 in the 6CO containing such context informaiton.
          -->
          <t> Specifying further details of such a scheme is left for future versions of this draft,
              if there is interest.
          </t>
          <!-- TODO: check impact on RPL -->
        </section>
      </section>
    </section>

    <section title='IANA Considerations'>
      <t> This document has no actions for IANA.
      </t>
    </section>

    <section title='Security Considerations'>
      <t> This entire document is about security considerations and possible mitigations.
      </t>
      <!--
          RFC 6775 <xref target='RFC6775'/> section 11 states:
              In some future deployments, one might want to use SEcure Neighbor
              Discovery (SEND) [RFC3971] [RFC3972].  This is possible with the ARO
              as sent between hosts and routers, since the address that is being
              registered is the IPv6 source address of the NS and SEND verifies the
              IPv6 source address of the packet.
      -->
    </section>
  </middle>

  <back>

    <references title='Normative References'>
      &rfc2119;
      &rfc4944;
      &rfc6282;
      &rfc6775;
    </references>
   
    <references title='Informative References'>
      &rfc3315;
      &rfc3972;
      &rfc4941;
      &rfc5535;
      &rfc6496;
      &rfc6724;
      &rfc6973;
      &rfc7136;
      &rfc7217;
      &rfc7421;
      &I-D.ietf-6man-ipv6-address-generation-privacy;
      &I-D.ietf-6man-default-iids;
    </references>

  </back>
</rfc>
